(function(){var e;e=angular.module("skinnyBlog",["ngCookies","ui.router"]).config(["$stateProvider","$urlRouterProvider","$urlMatcherFactoryProvider","$locationProvider","$provide",function(e,t,r,n,i){return n.html5Mode(!0),r.strictMode(!1),t.otherwise(function(e){return e.invoke(["$state",function(e){return e.go("404")}])}),e.state("articles",{url:"^/",templateUrl:"partials/articles.html",controller:"ArticlesController as articles"}).state("articles/page",{url:"^/page/{page:[1-9][0-9]*}",templateUrl:"partials/articles.html",controller:"ArticlesController as articles"}).state("tag",{url:"^/tag/:tag",templateUrl:"partials/tag.html",controller:"ArticlesController as articles"}).state("tag/page",{url:"^/tag/:tag/page/{page:[1-9][0-9]*}",templateUrl:"partials/tag.html",controller:"ArticlesController as articles"}).state("article",{url:"^/{year:[0-9]{4}}/{month:[0-9]{2}}/:title",templateUrl:"partials/article.html",controller:"ArticleController as article"}).state("admin",{url:"^/admin",templateUrl:"partials/admin/dashboard.html",controller:"AdminDashboardController as dashboard",options:{secure:!0,title:"Admin"}}).state("admin/article",{url:"^/admin/articles/{id:[0-9]+}",templateUrl:"partials/admin/article.html",controller:"AdminArticleController as admin",options:{secure:!0,title:"Admin"}}).state("admin/article/new",{url:"^/admin/articles/new",templateUrl:"partials/admin/article.html",controller:"AdminArticleController as admin",options:{secure:!0,title:"Admin"}}).state("admin/login",{url:"^/admin/login",templateUrl:"partials/admin/login.html",controller:"AdminLoginController as login",options:{title:"Log In"}}).state("404",{templateUrl:"partials/404.html",options:{title:"Page not found"}}),i.decorator("$q",["$delegate",function(e){var t;return t=e.defer,e.defer=function(){var e;return e=t(),e.promise.success=function(t){return e.promise.then(t),e.promise},e.promise.error=function(t){return e.promise.then(null,t),e.promise},e},e}])}]),e.run(["$rootScope","$state","ActivityService","AuthService","Page",function(e,t,r,n,i){return r.decrementCounter(),e.$on("$stateChangeStart",function(e,r,i){return n.isAuthenticated&&"admin/login"===r.name?(e.preventDefault(),t.go("admin")):!n.isAuthenticated&&r.options&&r.options.secure?(e.preventDefault(),n.desiredState={state:r.name,params:i},t.go("admin/login")):void 0}),e.$on("$stateChangeSuccess",function(e,t){return i.reset(),t.options&&t.options.title?i.setTitle(t.options.title):void 0})}])}).call(this),function(){angular.module("skinnyBlog").controller("AdminLoginController",["$state","AuthService","ActivityService","AlertService",function(e,t,r,n){var i;return new(i=function(){function i(){this.signingIn=!1}return i.prototype.attempt=function(){var i;return this.signingIn=!0,i=t.signIn(),r.addPromise(i),i.success(function(r){return function(){return r.signingIn=!1,t.desiredState?e.go(t.desiredState.state,t.desiredState.params):e.go("admin")}}(this)).error(function(e){return function(t){return e.signingIn=!1,n.add("Error: "+t)}}(this))},i}())}])}.call(this),function(){angular.module("skinnyBlog").controller("ArticleController",["$state","$stateParams","$sce","ApiService","ActivityService","Page",function(e,t,r,n,i,a){var o;return new(o=function(){function o(){var o;this.raw=null,this.showComments=!0,o=n.getArticle(t.year,t.month,t.title),i.addPromise(o),o.success(function(e){return function(t){return e.raw=t.article,e.raw.html=r.trustAsHtml(e.raw.text),e.putArticleInScope(),a.setTitle(t.article.title),t.article.headerImage?a.setHeaderImage(t.article.headerImage):void 0}}(this)).error(function(){return e.go("404")})}return o.prototype.putArticleInScope=function(){var e,t,r,n,i;for(e=["title","html","publishedDate","slugParts","tags"],i=[],r=0,n=e.length;n>r;r++)t=e[r],i.push(this[t]=this.raw[t]);return i},o}())}])}.call(this),function(){angular.module("skinnyBlog").controller("ArticlesController",["$state","$sce","ApiService","ActivityService","Page",function(e,t,r,n,i){var a;return new(a=function(){function a(){var a,o;this.prevHref=null,this.nextHref=null,this.all=null,this.pages=null,a=e.params,this.page=a.page&&a.page>=1?parseInt(a.page):1,this.nextPage=this.page,this.previousPage=this.page,this.tag=a.tag?(this.rawTag=a.tag,a.tag.replace(/-/g," ")):null,o=r.getArticles(this.page,this.tag),n.addPromise(o),o.success(function(r){return function(n){var o,s,u,l,c,d;for(r.all=n.articles,d=r.all,l=0,c=d.length;c>l;l++)o=d[l],o.html=t.trustAsHtml(o.text);if(n.meta.pages){if(r.pages=n.meta.pages,(r.page>r.pages||r.page<1)&&e.go("404"),s=r.tag?"tag":"articles",a=r.tag?{tag:r.rawTag}:{},u=r.tag&&r.page>1?"Tag: "+r.tag+", page "+r.page:r.tag?"Tag: "+r.tag:r.page>1?"Page "+r.page:"",i.setTitle(u),r.page<r.pages&&(r.prevHref=e.href(s+"/page",angular.extend({},a,{page:r.page+1}))),2===r.page)return r.nextHref=e.href(s,a);if(r.page>2)return r.nextHref=e.href(s+"/page",angular.extend({},a,{page:r.page-1}))}}}(this)).error(function(e){return function(){return e.all=!1}}(this))}return a.prototype.closeTagSearch=function(){return this.tag?e.go("articles"):void 0},a}())}])}.call(this),function(){angular.module("skinnyBlog").factory("ActivityService",["$window",function(e){var t;return new(t=function(){function t(){this.element=angular.element(e.document.getElementById("activity-spinner")),this["class"]="off",this.counter=1}return t.prototype.decrementCounter=function(){return this.counter--,this.counter<0&&(this.counter=0),0===this.counter?this.element.addClass(this["class"]):void 0},t.prototype.incrementCounter=function(){return this.counter++,this.counter>0?this.element.removeClass(this["class"]):void 0},t.prototype.addPromise=function(e){var t;return this.incrementCounter(),t=function(e){return function(){return e.decrementCounter()}}(this),e.then(t,t)},t}())}])}.call(this),function(){angular.module("skinnyBlog").factory("AlertService",["$rootScope",function(e){var t;return new(t=function(){function t(){window.aleets=this}return t.prototype.add=function(t,r){return null==r&&(r="danger"),e.$broadcast("newAlert",{message:t,type:r})},t}())}])}.call(this),function(){var e,t;e=angular.module("skinnyBlog"),e.directive("bhArticle",function(){return{restrict:"E",templateUrl:"partials/article.html",scope:{article:"=bhModel"}}}),e.directive("sbHighlight",function(){return{restrict:"A",link:function(e,t){return require(["highlight"],function(e){var r,n,i,a,o;if(n=t.find("pre").find("code")){for(o=[],i=0,a=n.length;a>i;i++)r=n[i],o.push(e.highlightBlock(r));return o}})}}}),e.directive("bhMarkdown",function(){return{restrict:"A",scope:{markdown:"&bhMarkdown"},link:function(e,t){return require(["marked","highlight"],function(r,n){var i;return r.setOptions({langPrefix:"hljs ",highlight:function(e){return n.highlightAuto(e).value}}),i=function(){return e.markdown()?t.html(r(e.markdown())):void 0},i(),e.$watch(e.markdown,i)})}}}),e.directive("bhPickadate",function(){return{restrict:"A",scope:{date:"=bhPickadate",updateFn:"&bhPickadateChange"},link:function(e,t){return require(["picker","picker.date"],function(){var r,n,i;return r=$(t),r.pickadate({format:"d mmmm yyyy",onSet:function(t){var r;return r=t.select,r instanceof Date?void 0:e.date.setTime(r)}}),n=r.pickadate("picker"),i=function(e){return e?n.set("select",e):void 0},i(e.date),e.$watch("date",i)})}}}),e.directive("bhEditor",["AuthService","ActivityService","AlertService",function(e,t,r){return{restrict:"A",scope:{theme:"@bhEditorTheme",language:"@bhEditorLanguage",update:"&bhEditorUpdate",model:"=bhEditorModel"},link:function(n,i){return require(["ace","dropzone"],function(){var a,o,s,u;return u=n.theme?n.theme:"monokai",o=n.language?n.language:"markdown",a=ace.edit(i[0]),a.setTheme("ace/theme/"+u),a.getSession().setMode("ace/mode/"+o),a.getSession().setUseSoftTabs(!0),n.model&&a.setValue(n.model),n.$watch("model",function(){return!a.getValue()&&n.model?a.setValue(n.model):void 0}),a.getSession().on("change",function(){return n.update()(a.getValue())}),s="![Uploading...]()",$(i).dropzone({url:"/api/images",headers:{"X-OAuth-Token":e.token},acceptedFiles:"image/*",drop:function(){return a.insert(s),t.incrementCounter()},success:function(e,t){return a.find(s),a.replace("!["+e.name+"]("+t.image+")")},error:function(){return a.find(s),a.replace(""),r.add("There was an error uploading the image.")},complete:function(){return t.decrementCounter()}})})}}}]),t=function(e){return function(t){return t.match(new RegExp(e,"i"))}},e.directive("bhTagInput",["$q","$timeout","ApiService","AuthService","ActivityService",function(e,r,n,i,a){return{restrict:"A",scope:{addTag:"&",removeTag:"&",tags:"="},link:function(o,s){return require(["jquery-ui"],function(){return require(["tag-it"],function(){var u,l,c,d,h,p,g,f;return u=$(s),f=null,g={},c=!1,l=function(e){return void 0!==g[e]?{id:g[e],name:e}:{name:e}},h=function(){var e,t,r,n;for(c=!0,u.tagit("removeAll"),n=o.tags,t=0,r=n.length;r>t;t++)e=n[t],u.tagit("createTag",e.name);return c=!1},p=e.defer(),d=n.getTags(i.token),a.addPromise(d),d.success(function(e){var t,r,n,i;for(i=e.tags,r=0,n=i.length;n>r;r++)t=i[r],g[t.name]=t.id;return f=function(){var r,n,i,a;for(i=e.tags,a=[],r=0,n=i.length;n>r;r++)t=i[r],a.push(t.name);return a}(),o.tags&&h(),p.resolve()}).error(function(){return p.rejct()}),u.tagit({allowSpaces:!0,removeConfirmation:!0,autocomplete:{delay:0,minLength:1,source:function(e,r){return f?r(f.filter(t(e.term))):p.success(function(){return r(f.filter(t(e.term)))}).error(function(){return r([])})}},beforeTagAdded:function(e,t){var r,n;return r=t.tag.find("span.tagit-label"),n=r.text().toLowerCase().replace(/[^0-9a-z ]+/gi,""),r.text(n)},afterTagAdded:function(e,t){return c?void 0:r(function(){return o.tags.push(l(t.tagLabel))})},afterTagRemoved:function(e,t){return c?void 0:r(function(){var e,r,n,i,a,s;for(a=o.tags,s=[],e=n=0,i=a.length;i>n;e=++n)r=a[e],s.push(r.name===t.tagLabel?o.tags.splice(e,1):void 0);return s})}}),o.$watch("tags",function(e,t){return e!==t?h():void 0})})})}}}]),e.directive("bhAlerts",["$timeout",function(e){return{restrict:"E",template:'<div class="alert" role="alert" ng-repeat="alert in alerts" ng-class="\'alert-\' + alert.type">\n    <button type="button" class="close" aria-label="Close" ng-click="close($index)">\n        <span aria-hidden="true">&times;</span>\n    </button>\n    {{ alert.message }}\n</div>',scope:{},link:function(t){return t.alerts=[],t.$on("newAlert",function(r,n){return e(function(){return t.alerts.push(n)})}),t.close=function(e){return t.alerts.splice(e,1)}}}}]),e.directive("bhPagination",function(){return{restrict:"E",replace:!0,template:'<nav>\n    <ul class="pager">\n        <li class="previous">\n            <a ng-href="{{ previousHref }}" ng-show="!previousDisabled" class="pure-button">\n                <span aria-hidden="true">&larr;</span> Older\n            </a>\n        </li>\n        <li class="next">\n            <a ng-href="{{ nextHref }}" ng-show="!nextDisabled" class="pure-button">\n                Newer <span aria-hidden="true">&rarr;</span>\n            </a>\n        </li>\n    </ul>\n</nav>',scope:{previousDisabled:"=",previousHref:"=",nextDisabled:"=",nextHref:"="}}}),e.directive("bhDisqus",["$window","$state",function(e,t){return{restrict:"E",replace:!0,scope:{article:"=",active:"="},template:'<div class="dsq-container" ng-if="active">\n  <div id="disqus_thread"></div>\n  <a href="http://disqus.com" class="dsq-brlink">\n    comments powered by <span class="logo-disqus">Disqus</span>\n  </a>\n</div>',link:function(r){var n,i;return n=null,i=function(i){var a;if(i&&i.title&&r.active&&(!n||i.id===n))return a={year:i.slugParts.year,month:i.slugParts.month,title:i.slugParts.title},e.disqus_shortname="blakeharley",e.disqus_identifier=t.href("article",a),e.disqus_title=i.title,e.disqus_url=t.href("article",a,{absolute:!0}),e.DISQUS?e.DISQUS.reset({reload:!0,config:function(){return this.page.identifier=e.disqus_identifier,this.page.url=e.disqus_url,this.page.title=e.disqus_title}}):require(["disqus"])},i(r.article),r.$watch("article",i)}}}])}.call(this),function(){angular.module("skinnyBlog").factory("AssetService",["$window",function(e){var t;return new(t=function(){function t(){this.assetMap={"jquery-ui":"//cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.2/jquery-ui.min.css","pure-forms":"//cdnjs.cloudflare.com/ajax/libs/pure/0.5.0/forms-min.css",pickadate:"//cdnjs.cloudflare.com/ajax/libs/pickadate.js/3.5.3/compressed/themes/default.css","pickadate-date":"//cdnjs.cloudflare.com/ajax/libs/pickadate.js/3.5.3/compressed/themes/default.date.css"},this.loadedAssets=[]}return t.prototype.requireMany=function(e){var t,r,n,i;for(i=[],r=0,n=e.length;n>r;r++)t=e[r],i.push(this.require(t));return i},t.prototype.require=function(e){var t;return this.assetLoaded(e)?void 0:(t=this.assetMap[e]?this.assetMap[e]:e,this.loadStylesheet(t),this.loadedAssets.push(e))},t.prototype.assetLoaded=function(e){return-1!==this.loadedAssets.indexOf(e)},t.prototype.loadStylesheet=function(t){var r;return r=e.document.createElement("link"),r.rel="stylesheet",r.type="text/css",r.href=t,e.document.getElementsByTagName("head")[0].appendChild(r)},t}())}])}.call(this),function(){angular.module("skinnyBlog").factory("AuthService",["$http","$cacheFactory","$window","$q","$cookieStore","ApiService",function(e,t,r,n,i,a){var o;return new(o=function(){function e(){this.token=this.getStoredToken(),this.isAuthenticated=!!this.token,this.desiredState=!1}return e.tokenKey="oauthToken",e.prototype.getStoredToken=function(){var t;return t=i.get(e.tokenKey),t&&new Date(t.expiration).getTime()>(new Date).getTime()?t.token:null},e.prototype.storeToken=function(t,r){return i.put(e.tokenKey,{token:t,expiration:r})},e.prototype.signIn=function(){var e;return e=n.defer(),r.googleOauthCallback=function(t){return function(r){var n;return r.status.signed_in?(t.token=r.access_token,n=new Date(1e3*parseInt(r.expires_at)),a.hasValidAuthentication(t.token).success(function(){return t.isAuthenticated=!0,t.storeToken(t.token,n),e.resolve()}).error(function(){return e.reject("You do not have permission to access this area")})):e.reject("Could not authenticate against Google OAuth")}}(this),a.getAuthInfo().success(function(e){return r.gapi.auth.signIn({clientid:e.clientId,cookiepolicy:"single_host_origin",callback:"googleOauthCallback"})}).error(function(){return e.reject("Could not get OAuth client ID")}),e.promise},e}())}])}.call(this),function(){angular.module("skinnyBlog").factory("Page",["$rootScope",function(e){var t;return new(t=function(){function t(){}return t.prototype.setTitle=function(t){return e.title=t},t.prototype.setHeaderImage=function(t){return e.headerImage=t},t.prototype.reset=function(){return e.title=null,e.headerImage=null},t}())}])}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};angular.module("skinnyBlog").controller("AdminArticleController",["$scope","$timeout","$state","$stateParams","ApiService","AuthService","ActivityService","AlertService","AssetService",function(t,r,n,i,a,o,s,u,l){var c;return new(c=function(){function t(){this.articleText=e(this.articleText,this);var t;this.saving=!1,this.isSlugDirty=!1,this.article=null,this.pristineArticle=!1,l.requireMany(["jquery-ui","pure-forms","pickadate","pickadate-date"]),i.id?(t=a.getArticle(i.id),s.addPromise(t),t.success(function(e){return function(t){return e.article=t.article,e.article.publishedDate=new Date(e.article.publishedDate),e.isSlugDirty=e.article.published,e.pristineArticle=angular.copy(e.article)}}(this)).error(function(){return u.add("Alert id:"+i.id+" not found."),n.go("admin")})):(this.article={published:!1,publishedDate:new Date,tags:[]},this.pristineArticle=angular.copy(this.article))}return t.prototype.publish=function(){return this.article.published=!0,this.save(!0)},t.prototype.save=function(e){var t,r;return null==e&&(e=!1),this.saving=!0,t=!this.article.id,r=t?a.createArticle(this.article,o.token):a.saveArticle(this.article,o.token),s.addPromise(r),r.success(function(r){return function(i){return r.saving=!1,t&&(r.article.id=i.article.id),e?(u.add('Article "'+r.article.title+'" saved.',"success"),n.go("admin")):void 0}}(this)).error(function(e){return function(){return e.saving=!1,u.add("Article could not be saved.")}}(this))},t.prototype.updateSlug=function(e){var t;return null==e&&(e=!1),t=function(e){return function(){var t,r,n;return e.article.slug=!e.isSlugDirty&&e.article.title&&e.article.publishedDate&&e.article.publishedDate.getFullYear()?(n=e.article.publishedDate.getFullYear(),t=""+(e.article.publishedDate.getMonth()+1),t="00".substring(0,2-t.length)+t,r=e.article.title.replace(/[^a-z0-9 -]+/gi,"").replace(/\s+/g,"-").toLowerCase(),n+"/"+t+"/"+r):e.article.slug}}(this),e?r(t):t()},t.prototype.articleText=function(e){return null==e&&(e=null),null!==e?r(function(t){return function(){return t.article.text=e}}(this)):e},t}())}])}.call(this),function(){angular.module("skinnyBlog").controller("AdminDashboardController",["ApiService","ActivityService","AuthService","AlertService",function(e,t,r,n){var i;return new(i=function(){function i(){var n;this.articles=null,n=e.adminGetArticles(r.token),t.addPromise(n),n.success(function(e){return function(t){return e.articles=t.articles}}(this)).error(function(e){return function(){return e.articles=!1}}(this))}return i.prototype.deleteArticle=function(t){var i,a;return window.confirm("Are you sure you want to delete this article?")?(i=this.articles[t],a=e.adminDeleteArticle(i.id,r.token),a.success(function(e){return function(){return e.articles.splice(t,1)}}(this)).error(function(){return n.add("Article id:"+i.id+" could not be deleted.")})):void 0},i}())}])}.call(this),function(){angular.module("skinnyBlog").factory("ApiService",["$http","$cacheFactory","$q",function(e,t,r){var n;return new(n=function(){function n(){this.cache=t("apiServiceCache")}return n.prototype.getArticles=function(t,n){return null==t&&(t=1),null==n&&(n=null),this.cacheOrPerform("articles "+t+" "+n,function(i){return function(){var a,o;return a=r.defer(),o="/api/articles?page="+t,null!==n&&(o+="&tag="+n),e.get(o).success(function(e){return i.cacheArticles(e.articles),a.resolve(e)}).error(function(e){return a.reject(e)}),a.promise}}(this))},n.prototype.getArticle=function(t,r,n){var i;return null==r&&(r=null),null==n&&(n=null),i=null!==r&&null!==n?t+"/"+r+"/"+n:t,this.cacheOrPerform("article:"+i,function(){return e.get("/api/articles/"+i)})},n.prototype.createArticle=function(t,r){return e.post("/api/articles",{article:t},this.authHeaders(r))},n.prototype.saveArticle=function(t,r){return e.put("/api/articles/"+t.id,{article:t},this.authHeaders(r))},n.prototype.getTags=function(t){return e.get("/api/tags",this.authHeaders(t))},n.prototype.cacheArticles=function(e){var t,n,i,a,o;for(o=[],i=0,a=e.length;a>i;i++)t=e[i],n=r.defer(),n.resolve({article:t}),o.push(this.cache.put("article:"+t.slug,n.promise));return o},n.prototype.getAuthInfo=function(){return this.cacheOrPerform("oauth clientId",function(){return e.get("/api/auth/info")})},n.prototype.hasValidAuthentication=function(t){return e.get("/api/auth/check",this.authHeaders(t))},n.prototype.adminGetArticles=function(t){return e.get("/api/articles/all",this.authHeaders(t))},n.prototype.adminDeleteArticle=function(t){return e["delete"]("/api/articles/"+t,this.authHeaders(token))},n.prototype.authHeaders=function(e){return{headers:{"X-OAuth-Token":e}}},n.prototype.cacheOrPerform=function(e,t){var r;return r=this.cache.get(e),void 0===r&&(r=t(),this.cache.put(e,r)),r},n}())}])}.call(this);
//# sourceMappingURL=app.min.js.map