(function(){var t;t=angular.module("skinnyBlog",["ngCookies","ui.router"]).config(["$stateProvider","$urlRouterProvider","$urlMatcherFactoryProvider","$locationProvider","$provide",function(t,e,r,n,i){return n.html5Mode(!0),r.strictMode(!1),e.otherwise(function(t){return t.invoke(["$state",function(t){return t.go("404")}])}),t.state("articles",{url:"^/",templateUrl:"partials/articles.html",controller:"ArticlesController as articles"}).state("articles/page",{url:"^/page/{page:[1-9][0-9]*}",templateUrl:"partials/articles.html",controller:"ArticlesController as articles"}).state("tag",{url:"^/tag/:tag",templateUrl:"partials/tag.html",controller:"ArticlesController as articles"}).state("tag/page",{url:"^/tag/:tag/page/{page:[1-9][0-9]*}",templateUrl:"partials/tag.html",controller:"ArticlesController as articles"}).state("article",{url:"^/{year:[0-9]{4}}/{month:[0-9]{2}}/:title",templateUrl:"partials/article.html",controller:"ArticleController as article"}).state("admin",{url:"^/admin",templateUrl:"partials/admin/dashboard.html",controller:"AdminDashboardController as dashboard",options:{secure:!0,title:"Admin"}}).state("admin/article",{url:"^/admin/articles/{id:[0-9]+}",templateUrl:"partials/admin/article.html",controller:"AdminArticleController as admin",options:{secure:!0,title:"Admin"}}).state("admin/article/new",{url:"^/admin/articles/new",templateUrl:"partials/admin/article.html",controller:"AdminArticleController as admin",options:{secure:!0,title:"Admin"}}).state("admin/login",{url:"^/admin/login",templateUrl:"partials/admin/login.html",controller:"AdminLoginController as login",options:{title:"Log In"}}).state("404",{templateUrl:"partials/404.html",options:{title:"Page not found"}}),i.decorator("$q",["$delegate",function(t){var e;return e=t.defer,t.defer=function(){var t;return t=e(),t.promise.success=function(e){return t.promise.then(e),t.promise},t.promise.error=function(e){return t.promise.then(null,e),t.promise},t},t}])}]),t.run(["$rootScope","$state","ActivityService","AuthService","Page",function(t,e,r,n,i){return r.decrementCounter(),t.$on("$stateChangeStart",function(t,r,i){return n.isAuthenticated&&"admin/login"===r.name?(t.preventDefault(),e.go("admin")):!n.isAuthenticated&&r.options&&r.options.secure?(t.preventDefault(),n.desiredState={state:r.name,params:i},e.go("admin/login")):void 0}),t.$on("$stateChangeSuccess",function(t,e){return i.reset(),e.options&&e.options.title?i.setTitle(e.options.title):void 0})}])}).call(this),function(){angular.module("skinnyBlog").controller("AdminLoginController",["$state","AuthService","ActivityService","AlertService",function(t,e,r,n){var i;return new(i=function(){function i(){this.signingIn=!1}return i.prototype.attempt=function(){var i;return this.signingIn=!0,i=e.signIn(),r.addPromise(i),i.success(function(r){return function(){return r.signingIn=!1,e.desiredState?t.go(e.desiredState.state,e.desiredState.params):t.go("admin")}}(this)).error(function(t){return function(e){return t.signingIn=!1,n.add("Error: "+e)}}(this))},i}())}])}.call(this),function(){angular.module("skinnyBlog").controller("ArticleController",["$state","$stateParams","$sce","ApiService","ActivityService","Page",function(t,e,r,n,i,a){var o;return new(o=function(){function o(){var o;this.raw=null,this.showComments=!0,o=n.getArticle(e.year,e.month,e.title),i.addPromise(o),o.success(function(t){return function(e){return t.raw=e.article,t.raw.html=r.trustAsHtml(t.raw.text),t.putArticleInScope(),a.setTitle(e.article.title),e.article.headerImage?a.setHeaderImage(e.article.headerImage):void 0}}(this)).error(function(){return t.go("404")})}return o.prototype.putArticleInScope=function(){var t,e,r,n,i;for(t=["title","html","publishedDate","slugParts","tags"],i=[],r=0,n=t.length;n>r;r++)e=t[r],i.push(this[e]=this.raw[e]);return i},o}())}])}.call(this),function(){angular.module("skinnyBlog").controller("ArticlesController",["$state","$sce","ApiService","ActivityService","Page",function(t,e,r,n,i){var a;return new(a=function(){function a(){var a,o;this.prevHref=null,this.nextHref=null,this.all=null,this.pages=null,a=t.params,this.page=a.page&&a.page>=1?parseInt(a.page):1,this.nextPage=this.page,this.previousPage=this.page,this.tag=a.tag?(this.rawTag=a.tag,a.tag.replace(/-/g," ")):null,o=r.getArticles(this.page,this.tag),n.addPromise(o),o.success(function(r){return function(n){var o,u,l,c,s,d;for(r.all=n.articles,d=r.all,c=0,s=d.length;s>c;c++)o=d[c],o.html=e.trustAsHtml(o.text);if(n.meta.pages){if(r.pages=n.meta.pages,(r.page>r.pages||r.page<1)&&t.go("404"),u=r.tag?"tag":"articles",a=r.tag?{tag:r.rawTag}:{},l=r.tag&&r.page>1?"Tag: "+r.tag+", page "+r.page:r.tag?"Tag: "+r.tag:r.page>1?"Page "+r.page:"",i.setTitle(l),r.page<r.pages&&(r.prevHref=t.href(u+"/page",$.extend({},a,{page:r.page+1}))),2===r.page)return r.nextHref=t.href(u,a);if(r.page>2)return r.nextHref=t.href(u+"/page",$.extend({},a,{page:r.page-1}))}}}(this)).error(function(t){return function(){return t.all=!1}}(this))}return a.prototype.closeTagSearch=function(){return this.tag?t.go("articles"):void 0},a}())}])}.call(this),function(){angular.module("skinnyBlog").factory("ActivityService",function(){var t;return new(t=function(){function t(){this.element=$("#activity-spinner"),this.counter=1}return t.prototype.decrementCounter=function(){return this.counter--,this.counter<0&&(this.counter=0),0===this.counter?this.element.finish().fadeOut():void 0},t.prototype.incrementCounter=function(){return this.counter++,this.counter>0?this.element.finish().fadeIn():void 0},t.prototype.addPromise=function(t){var e;return this.incrementCounter(),e=function(t){return function(){return t.decrementCounter()}}(this),t.then(e,e)},t}())})}.call(this),function(){angular.module("skinnyBlog").factory("AlertService",["$rootScope",function(t){var e;return new(e=function(){function e(){window.aleets=this}return e.prototype.add=function(e,r){return null==r&&(r="danger"),t.$broadcast("newAlert",{message:e,type:r})},e}())}])}.call(this),function(){var t,e;t=angular.module("skinnyBlog"),t.directive("bhArticle",function(){return{restrict:"E",templateUrl:"partials/article.html",scope:{article:"=bhModel"}}}),t.directive("sbHighlight",function(){return{restrict:"A",link:function(t,e){return require(["highlight"],function(t){return e.find("pre code").each(function(e,r){return t.highlightBlock(r)})})}}}),t.directive("bhMarkdown",function(){return{restrict:"A",scope:{markdown:"&bhMarkdown"},link:function(t,e){return require(["marked","highlight"],function(r,n){var i;return r.setOptions({langPrefix:"hljs ",highlight:function(t){return n.highlightAuto(t).value}}),i=function(){return t.markdown()?e.html(r(t.markdown())):void 0},i(),t.$watch(t.markdown,i)})}}}),t.directive("bhPickadate",function(){return{restrict:"A",scope:{date:"=bhPickadate",updateFn:"&bhPickadateChange"},link:function(t,e){return require(["picker","picker.date"],function(){var r,n,i;return r=$(e),r.pickadate({format:"d mmmm yyyy",onSet:function(e){var r;return r=e.select,r instanceof Date?void 0:t.date.setTime(r)}}),n=r.pickadate("picker"),i=function(t){return t?n.set("select",t):void 0},i(t.date),t.$watch("date",i)})}}}),t.directive("bhEditor",["AuthService","ActivityService","AlertService",function(t,e,r){return{restrict:"A",scope:{theme:"@bhEditorTheme",language:"@bhEditorLanguage",update:"&bhEditorUpdate",model:"=bhEditorModel"},link:function(n,i){return require(["ace","dropzone"],function(){var a,o,u,l;return l=n.theme?n.theme:"monokai",o=n.language?n.language:"markdown",a=ace.edit(i[0]),a.setTheme("ace/theme/"+l),a.getSession().setMode("ace/mode/"+o),a.getSession().setUseSoftTabs(!0),n.model&&a.setValue(n.model),n.$watch("model",function(){return!a.getValue()&&n.model?a.setValue(n.model):void 0}),a.getSession().on("change",function(){return n.update()(a.getValue())}),u="![Uploading...]()",$(i).dropzone({url:"/api/images",headers:{"X-OAuth-Token":t.token},acceptedFiles:"image/*",drop:function(){return a.insert(u),e.incrementCounter()},success:function(t,e){return a.find(u),a.replace("!["+t.name+"]("+e.image+")")},error:function(){return a.find(u),a.replace(""),r.add("There was an error uploading the image.")},complete:function(){return e.decrementCounter()}})})}}}]),e=function(t){return function(e){return e.match(new RegExp(t,"i"))}},t.directive("bhTagInput",["$q","$timeout","ApiService","AuthService","ActivityService",function(t,r,n,i,a){return{restrict:"A",scope:{addTag:"&",removeTag:"&",tags:"="},link:function(o,u){return require(["jquery-ui"],function(){return require(["tag-it"],function(){var l,c,s,d,h,g,p,f;return l=$(u),f=null,p={},s=!1,c=function(t){return void 0!==p[t]?{id:p[t],name:t}:{name:t}},h=function(){var t,e,r,n;for(s=!0,l.tagit("removeAll"),n=o.tags,e=0,r=n.length;r>e;e++)t=n[e],l.tagit("createTag",t.name);return s=!1},g=t.defer(),d=n.getTags(i.token),a.addPromise(d),d.success(function(t){var e,r,n,i;for(i=t.tags,r=0,n=i.length;n>r;r++)e=i[r],p[e.name]=e.id;return f=function(){var r,n,i,a;for(i=t.tags,a=[],r=0,n=i.length;n>r;r++)e=i[r],a.push(e.name);return a}(),o.tags&&h(),g.resolve()}).error(function(){return g.rejct()}),l.tagit({allowSpaces:!0,removeConfirmation:!0,autocomplete:{delay:0,minLength:1,source:function(t,r){return f?r(f.filter(e(t.term))):g.success(function(){return r(f.filter(e(t.term)))}).error(function(){return r([])})}},beforeTagAdded:function(t,e){var r,n;return r=e.tag.find("span.tagit-label"),n=r.text().toLowerCase().replace(/[^0-9a-z ]+/gi,""),r.text(n)},afterTagAdded:function(t,e){return s?void 0:r(function(){return o.tags.push(c(e.tagLabel))})},afterTagRemoved:function(t,e){return s?void 0:r(function(){var t,r,n,i,a,u;for(a=o.tags,u=[],t=n=0,i=a.length;i>n;t=++n)r=a[t],u.push(r.name===e.tagLabel?o.tags.splice(t,1):void 0);return u})}}),o.$watch("tags",function(t,e){return t!==e?h():void 0})})})}}}]),t.directive("bhAlerts",["$timeout",function(t){return{restrict:"E",template:'<div class="alert" role="alert" ng-repeat="alert in alerts" ng-class="\'alert-\' + alert.type">\n    <button type="button" class="close" aria-label="Close" ng-click="close($index)">\n        <span aria-hidden="true">&times;</span>\n    </button>\n    {{ alert.message }}\n</div>',scope:{},link:function(e){return e.alerts=[],e.$on("newAlert",function(r,n){return t(function(){return e.alerts.push(n)})}),e.close=function(t){return e.alerts.splice(t,1)}}}}]),t.directive("bhPagination",function(){return{restrict:"E",replace:!0,template:'<nav>\n    <ul class="pager">\n        <li class="previous">\n            <a ng-href="{{ previousHref }}" ng-show="!previousDisabled" class="pure-button">\n                <span aria-hidden="true">&larr;</span> Older\n            </a>\n        </li>\n        <li class="next">\n            <a ng-href="{{ nextHref }}" ng-show="!nextDisabled" class="pure-button">\n                Newer <span aria-hidden="true">&rarr;</span>\n            </a>\n        </li>\n    </ul>\n</nav>',scope:{previousDisabled:"=",previousHref:"=",nextDisabled:"=",nextHref:"="}}}),t.directive("bhDisqus",["$window","$state",function(t,e){return{restrict:"E",replace:!0,scope:{article:"=",active:"="},template:'<div class="dsq-container" ng-if="active">\n  <div id="disqus_thread"></div>\n  <a href="http://disqus.com" class="dsq-brlink">\n    comments powered by <span class="logo-disqus">Disqus</span>\n  </a>\n</div>',link:function(r){var n,i;return n=null,i=function(i){var a;if(i&&i.title&&r.active&&(!n||i.id===n))return a={year:i.slugParts.year,month:i.slugParts.month,title:i.slugParts.title},t.disqus_shortname="blakeharley",t.disqus_identifier=e.href("article",a),t.disqus_title=i.title,t.disqus_url=e.href("article",a,{absolute:!0}),t.DISQUS?t.DISQUS.reset({reload:!0,config:function(){return this.page.identifier=t.disqus_identifier,this.page.url=t.disqus_url,this.page.title=t.disqus_title}}):require(["disqus"])},i(r.article),r.$watch("article",i)}}}])}.call(this),function(){angular.module("skinnyBlog").factory("AuthService",["$http","$cacheFactory","$window","$q","$cookieStore","ApiService",function(t,e,r,n,i,a){var o;return new(o=function(){function t(){this.token=this.getStoredToken(),this.isAuthenticated=!!this.token,this.desiredState=!1}return t.tokenKey="oauthToken",t.prototype.getStoredToken=function(){var e;return e=i.get(t.tokenKey),e&&new Date(e.expiration).getTime()>(new Date).getTime()?e.token:null},t.prototype.storeToken=function(e,r){return i.put(t.tokenKey,{token:e,expiration:r})},t.prototype.signIn=function(){var t;return t=n.defer(),r.googleOauthCallback=function(e){return function(r){var n;return r.status.signed_in?(e.token=r.access_token,n=new Date(1e3*parseInt(r.expires_at)),a.hasValidAuthentication(e.token).success(function(){return e.isAuthenticated=!0,e.storeToken(e.token,n),t.resolve()}).error(function(){return t.reject("You do not have permission to access this area")})):t.reject("Could not authenticate against Google OAuth")}}(this),a.getAuthInfo().success(function(t){return r.gapi.auth.signIn({clientid:t.clientId,cookiepolicy:"single_host_origin",callback:"googleOauthCallback"})}).error(function(){return t.reject("Could not get OAuth client ID")}),t.promise},t}())}])}.call(this),function(){angular.module("skinnyBlog").factory("Page",["$rootScope",function(t){var e;return new(e=function(){function e(){}return e.prototype.setTitle=function(e){return t.title=e},e.prototype.setHeaderImage=function(e){return t.headerImage=e},e.prototype.reset=function(){return t.title=null,t.headerImage=null},e}())}])}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};angular.module("skinnyBlog").controller("AdminArticleController",["$scope","$timeout","$state","$stateParams","ApiService","AuthService","ActivityService","AlertService",function(e,r,n,i,a,o,u,l){var c;return new(c=function(){function e(){this.articleText=t(this.articleText,this);var e;this.saving=!1,this.isSlugDirty=!1,this.article=null,this.pristineArticle=!1,i.id?(e=a.getArticle(i.id),u.addPromise(e),e.success(function(t){return function(e){return t.article=e.article,t.article.publishedDate=new Date(t.article.publishedDate),t.isSlugDirty=t.article.published,t.pristineArticle=angular.copy(t.article)}}(this)).error(function(){return l.add("Alert id:"+i.id+" not found."),n.go("admin")})):(this.article={published:!1,publishedDate:new Date,tags:[]},this.pristineArticle=angular.copy(this.article))}return e.prototype.publish=function(){return this.article.published=!0,this.save(!0)},e.prototype.save=function(t){var e,r;return null==t&&(t=!1),this.saving=!0,e=!this.article.id,r=e?a.createArticle(this.article,o.token):a.saveArticle(this.article,o.token),u.addPromise(r),r.success(function(r){return function(i){return r.saving=!1,e&&(r.article.id=i.article.id),t?(l.add('Article "'+r.article.title+'" saved.',"success"),n.go("admin")):void 0}}(this)).error(function(t){return function(){return t.saving=!1,l.add("Article could not be saved.")}}(this))},e.prototype.updateSlug=function(t){var e;return null==t&&(t=!1),e=function(t){return function(){var e,r,n;return t.article.slug=!t.isSlugDirty&&t.article.title&&t.article.publishedDate&&t.article.publishedDate.getFullYear()?(n=t.article.publishedDate.getFullYear(),e=""+(t.article.publishedDate.getMonth()+1),e="00".substring(0,2-e.length)+e,r=t.article.title.replace(/[^a-z0-9 -]+/gi,"").replace(/\s+/g,"-").toLowerCase(),n+"/"+e+"/"+r):t.article.slug}}(this),t?r(e):e()},e.prototype.articleText=function(t){return null==t&&(t=null),null!==t?r(function(e){return function(){return e.article.text=t}}(this)):t},e}())}])}.call(this),function(){angular.module("skinnyBlog").controller("AdminDashboardController",["ApiService","ActivityService","AuthService","AlertService",function(t,e,r,n){var i;return new(i=function(){function i(){var n;this.articles=null,n=t.adminGetArticles(r.token),e.addPromise(n),n.success(function(t){return function(e){return t.articles=e.articles}}(this)).error(function(t){return function(){return t.articles=!1}}(this))}return i.prototype.deleteArticle=function(e){var i,a;return window.confirm("Are you sure you want to delete this article?")?(i=this.articles[e],a=t.adminDeleteArticle(i.id,r.token),a.success(function(t){return function(){return t.articles.splice(e,1)}}(this)).error(function(){return n.add("Article id:"+i.id+" could not be deleted.")})):void 0},i}())}])}.call(this),function(){angular.module("skinnyBlog").factory("ApiService",["$http","$cacheFactory","$q",function(t,e,r){var n;return new(n=function(){function n(){this.cache=e("apiServiceCache")}return n.prototype.getArticles=function(e,n){return null==e&&(e=1),null==n&&(n=null),this.cacheOrPerform("articles "+e+" "+n,function(i){return function(){var a,o;return a=r.defer(),o="/api/articles?page="+e,null!==n&&(o+="&tag="+n),t.get(o).success(function(t){return i.cacheArticles(t.articles),a.resolve(t)}).error(function(t){return a.reject(t)}),a.promise}}(this))},n.prototype.getArticle=function(e,r,n){var i;return null==r&&(r=null),null==n&&(n=null),i=null!==r&&null!==n?e+"/"+r+"/"+n:e,this.cacheOrPerform("article:"+i,function(){return t.get("/api/articles/"+i)})},n.prototype.createArticle=function(e,r){return t.post("/api/articles",{article:e},this.authHeaders(r))},n.prototype.saveArticle=function(e,r){return t.put("/api/articles/"+e.id,{article:e},this.authHeaders(r))},n.prototype.getTags=function(e){return t.get("/api/tags",this.authHeaders(e))},n.prototype.cacheArticles=function(t){var e,n,i,a,o;for(o=[],i=0,a=t.length;a>i;i++)e=t[i],n=r.defer(),n.resolve({article:e}),o.push(this.cache.put("article:"+e.slug,n.promise));return o},n.prototype.getAuthInfo=function(){return this.cacheOrPerform("oauth clientId",function(){return t.get("/api/auth/info")})},n.prototype.hasValidAuthentication=function(e){return t.get("/api/auth/check",this.authHeaders(e))},n.prototype.adminGetArticles=function(e){return t.get("/api/articles/all",this.authHeaders(e))},n.prototype.adminDeleteArticle=function(e){return t["delete"]("/api/articles/"+e,this.authHeaders(token))},n.prototype.authHeaders=function(t){return{headers:{"X-OAuth-Token":t}}},n.prototype.cacheOrPerform=function(t,e){var r;return r=this.cache.get(t),void 0===r&&(r=e(),this.cache.put(t,r)),r},n}())}])}.call(this);
//# sourceMappingURL=app.min.js.map