(function(){var t;t=angular.module("skinnyBlog",["ui.router"]).config(["$stateProvider","$urlRouterProvider","$locationProvider","$provide",function(t,e,r,n){return r.html5Mode(!0),t.state("articles",{url:"^/",templateUrl:"partials/articles.html",controller:"ArticlesController as articles"}).state("tag",{url:"^/tag/:tag",templateUrl:"partials/articles.html",controller:"ArticlesController as articles"}).state("article",{url:"^/{year:[0-9]{4}}/{month:[0-9]{2}}/:title",templateUrl:"partials/article.html",controller:"ArticleController as article"}).state("admin",{url:"^/admin",templateUrl:"partials/admin/dashboard.html",controller:"AdminDashboardController as dashboard"}).state("admin/article",{url:"^/admin/articles/{id:[0-9]+}",templateUrl:"partials/admin/article.html",controller:"AdminArticleController as article"}),n.decorator("$q",["$delegate",function(t){var e;return e=t.defer,t.defer=function(){var t;return t=e(),t.promise.success=function(e){return t.promise.then(e),t.promise},t.promise.error=function(e){return t.promise.then(null,e),t.promise},t},t}])}]),t.run(["ActivityService",function(t){return t.decrementCounter()}]),t.directive("bhMarkdown",function(){return{restrict:"A",scope:{markdown:"&bhMarkdown"},link:function(t,e){return t.$watch(t.markdown,function(){return t.markdown()?e.html(marked(t.markdown())):void 0})}}}),t.directive("bhPickadate",function(){return{restrict:"A",scope:{date:"=bhPickadate",updateFn:"&bhPickadateChange"},link:function(t,e){var r,n;return r=$(e),r.pickadate({format:"d mmmm yyyy",onSet:function(e){var r;return r=e.select,r instanceof Date?void 0:(t.date.setTime(r),console.log(t.updateFn()))}}),n=r.pickadate("picker"),t.$watch("date",function(t){return t?n.set("select",t):void 0})}}}),t.directive("bhEditor",function(){return{restrict:"A",scope:{theme:"@bhEditorTheme",language:"@bhEditorLanguage",update:"&bhEditorUpdate",model:"=bhEditorModel"},link:function(t,e){var r,n,i;return i=t.theme?t.theme:"monokai",n=t.language?t.language:"markdown",r=ace.edit(e[0]),r.setTheme("ace/theme/"+i),r.getSession().setMode("ace/mode/"+n),r.getSession().setUseSoftTabs(!0),t.$watch("model",function(){return!r.getValue()&&t.model?r.setValue(t.model):void 0}),r.getSession().on("change",function(){return t.update()(r.getValue())})}}})}).call(this),function(){angular.module("skinnyBlog").controller("ArticleController",["$stateParams","ApiService","ActivityService",function(t,e,r){var n;return new(n=function(){function n(){var n;n=e.getArticle(t.year,t.month,t.title),r.addPromise(n),n.success(function(t){return function(e){return t.putArticleInScope(e.article)}}(this)).error(function(t){return console.log(t)})}return n.prototype.putArticleInScope=function(t){var e,r,n,i,o;for(e=["title","text","publishedDate","slugParts","tags"],o=[],n=0,i=e.length;i>n;n++)r=e[n],o.push(this[r]=t[r]);return o},n}())}])}.call(this),function(){angular.module("skinnyBlog").controller("ArticlesController",["$stateParams","ApiService","ActivityService",function(t,e,r){var n;return new(n=function(){function n(){var n;this.all=null,n=t.tag?(this.rawTag=t.tag,this.tag=t.tag.replace(/-/g," "),e.getArticlesWithTag(t.tag)):e.getArticles(),r.addPromise(n),n.success(function(t){return function(e){return t.all=e.articles}}(this)).error(function(t){return function(){return t.all=!1}}(this))}return n}())}])}.call(this),function(){angular.module("skinnyBlog").factory("ActivityService",function(){var t;return new(t=function(){function t(){this.element=$("#activity-spinner"),this.counter=1}return t.prototype.decrementCounter=function(){return this.counter--,this.counter<0&&(this.counter=0),0===this.counter?this.element.finish().fadeOut():void 0},t.prototype.incrementCounter=function(){return this.counter++,this.counter>0?this.element.finish().fadeIn():void 0},t.prototype.addPromise=function(t){var e;return this.incrementCounter(),e=function(t){return function(){return t.decrementCounter()}}(this),t.then(e,e)},t}())})}.call(this),function(){angular.module("skinnyBlog").factory("ApiService",["$http","$cacheFactory","$q",function(t,e,r){var n;return new(n=function(){function n(){this.cache=e("apiServiceCache")}return n.prototype.getArticles=function(){return this.cacheOrPerform("articles",function(e){return function(){var n;return n=r.defer(),t.get("/api/articles").success(function(t){return e.cacheArticles(t.articles),n.resolve(t)}).error(function(t){return n.reject(t)}),n.promise}}(this))},n.prototype.getArticlesWithTag=function(e){return this.cacheOrPerform("articles tag:"+e,function(n){return function(){var i;return i=r.defer(),t.get("/api/articles?tag="+e).success(function(t){return n.cacheArticles(t.articles),i.resolve(t)}).error(function(t){return i.reject(t)}),i.promise}}(this))},n.prototype.getArticle=function(e,r,n){var i;return null==r&&(r=null),null==n&&(n=null),i=null!==r&&null!==n?e+"/"+r+"/"+n:e,this.cacheOrPerform("article:"+i,function(){return t.get("/api/articles/"+i)})},n.prototype.cacheArticles=function(t){var e,n,i,o,c;for(c=[],i=0,o=t.length;o>i;i++)e=t[i],n=r.defer(),n.resolve({article:e}),c.push(this.cache.put("article:"+e.slug,n.promise));return c},n.prototype.adminGetArticles=function(){return this.cacheOrPerform("admin articles",function(){return t.get("/api/articles/all")})},n.prototype.adminDeleteArticle=function(e){return t["delete"]("/api/articles/"+e)},n.prototype.cacheOrPerform=function(t,e){var r;return r=this.cache.get(t),void 0===r&&(r=e(),this.cache.put(t,r)),r},n}())}])}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};angular.module("skinnyBlog").controller("AdminArticleController",["$scope","$timeout","$stateParams","ApiService","ActivityService",function(e,r,n,i,o){var c;return new(c=function(){function e(){this.getSetText=t(this.getSetText,this);var e;window.feesh=this,e=i.getArticle(n.id),o.addPromise(e),e.success(function(t){return function(e){return t.putArticleInScope(e.article)}}(this)).error(function(t){return console.log(t)}),this.isSlugDirty=!1}return e.prototype.updateSlug=function(t){var e;return null==t&&(t=!1),e=function(t){return function(){var e,r,n;return t.slug=!t.isSlugDirty&&t.title&&t.publishedDate&&t.publishedDate.getFullYear()?(n=t.publishedDate.getFullYear(),e=""+(t.publishedDate.getMonth()+1),e="00".substring(0,2-e.length)+e,r=t.title.replace(/[^a-z0-9 -]+/gi,"").replace(/\s+/g,"-").toLowerCase(),n+"/"+e+"/"+r):t.slug}}(this),t?r(e):e()},e.prototype.getSetText=function(t){return null==t&&(t=null),null!==t?r(function(e){return function(){return e.text=t}}(this)):t},e.prototype.putArticleInScope=function(t){var e,r,n;n=[];for(e in t)r=t[e],"publishedDate"===e&&(r=new Date(r)),n.push(this[e]=r);return n},e}())}])}.call(this),function(){angular.module("skinnyBlog").controller("AdminDashboardController",["ApiService","ActivityService",function(t,e){var r;return new(r=function(){function r(){var r;this.articles=null,r=t.adminGetArticles(),e.addPromise(r),r.success(function(t){return function(e){return t.articles=e.articles}}(this)).error(function(t){return function(){return t.articles=!1}}(this))}return r.prototype.deleteArticle=function(e){var r,n;return window.confirm("Are you sure you want to delete this article?")?(r=this.articles[e],n=t.adminDeleteArticle(r.id),n.success(function(t){return function(){return t.articles.splice(e,1)}}(this)).error(function(){return console.log("Error")})):void 0},r}())}])}.call(this);
//# sourceMappingURL=app.min.js.map